<!doctype html>
<html>
  <style type="text/css">
      body { font-family: arial; }
      thead tr td { font-weight: bold; }
      tr.success { background-color:green; }
      tr.fail { background-color:red; }
  </style>
    
  <script src="transformer_fte.js"></script>
  <script src="transformer.js"></script>
  
  <script>
      var testResults = [
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'a'
          },
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxx'
          },
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'Hello, World!'
          },
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'Hello World'
          },
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' // 32 xs
          },
          {
              'inputLanguage': '^\C+$',
              'inputMaxLen': 128,
              'outputLanguage': '^\C+$',
              'outputMaxLen': 128,
              'key': 'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF',
              'plaintext': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' // 32 xs
          }
      ];
  </script>
  
  <script>
    // Utility function to convert Uint8Array to string.
    function ab2str(buf) {
      return String.fromCharCode.apply(null, new Uint16Array(buf.buffer));
    }
    
    // Utility function to convert string to Uint8Array.
    function str2ab(str) {
      var buf = new Uint8Array(str.length*2); // 2 bytes for each char
      var bufView = new Uint16Array(buf.buffer);
      for (var i=0, strLen=str.length; i<strLen; i++) {
        bufView[i] = str.charCodeAt(i);
      }
      return buf;
    }
  </script>

  <script>
    function doTest(inputLanguage, inputMaxLen,
                    outputLanguage, outputMaxLen,
                    key, inputPlaintext) {

        try {
        var key = new Uint8Array(16);
        for (var i = 0; i < 16; i++) {
          key[i] = i;
        }

        var transformer = new Transformer();
        transformer.setKey(key);
        
        var abPlaintext = str2ab(inputPlaintext);
        var ciphertext = transformer.transform(abPlaintext);
        var abOutputPlaintext = transformer.restore(ciphertext);
        var outputPlaintext = ab2str(abOutputPlaintext);
        
        var success = (outputPlaintext === inputPlaintext);
        
        var trials = 10;
        var start = new Date().getTime();
        for (var i = 0; i < trials; i++) {
            ciphertext = transformer.transform(abPlaintext);
        }
        var end = new Date().getTime();
        var elapsed = end - start;
        elapsed = elapsed / trials;
    } catch (err) {
    } finally {
        transformer.dispose();
    }
        
        
        return [success, ciphertext, elapsed];
    }
    
  </script>
      
    <script>
        function outputTable() {
            for (var i = 0; i < testResults.length; i++) {
              retval = doTest(testResults[i]['inputLanguage'], testResults[i]['inputMaxLen'],
                                                      testResults[i]['outputLanguage'], testResults[i]['outputMaxLen'],
                                                      testResults[i]['key'], testResults[i]['plaintext']);
              var success = retval[0];
              var ciphertext = retval[1];
              var elapsed = retval[2];
            
              var rowClass = 'fail';  
              if (success) {
                  rowClass = 'success';
              }
              document.write('<tr class="'+rowClass+'">');
                  document.write('<td class="testNum">'+(i+1)+'</td>');
                  document.write('<td class="testInputLanguage">('+testResults[i]['inputLanguage']+', '+testResults[i]['inputMaxLen']+')</td>');
                  document.write('<td class="testInputLanguage">('+testResults[i]['outputLanguage']+', '+testResults[i]['outputMaxLen']+')</td>');
                  document.write('<td class="testKey">'+testResults[i]['key']+'</td>');
                  document.write('<td class="testInputPlaintext">');
                      document.write(testResults[i]['plaintext']);
                  document.write('</td>');
                  document.write('<td class="testOutputCiphertext">');
                      document.write(ciphertext);
                  document.write('</td>');
                  document.write('<td class="testCost">');
                      document.write(elapsed);
                  document.write('</td>');
              document.write('</tr>');
            }
        }
    </script>
  
  <body>
    <table border="1" cellspacing="5">
        <thead>
      <tr>
          <td class="testNum">Test #</td>
          <td class="testInputLanguage">Input Language</td>
          <td class="testOutputLanguage">Output Language</td>
          <td class="testKey">Key</td>
          <td class="testInputPlaintext">Input Plaintext</td>
          <td class="testOutputCiphertext">Output Ciphertext</td>
          <td class="testCost">Avg. Encrypt Cost (ms)</td>
      </tr>
    </thead>
        <script>outputTable();</script>
    </table>
      
  </body>
  
</html>

